{% extends "base.html" %}

{% load i18n %}

{% block head_title %}{% trans "Signup" %}{% endblock %}

{% block content %}

<div class="container">
  <div class="row">
    <div class="col-md-8 mt-3 offset-md-2">
      <!-- Signup form section with semantic structure -->
      <section aria-labelledby="signup-heading">
        <div class="card">
          <div class="card-body">
            <h1 id="signup-heading">{% trans "Sign Up" %}</h1>

            <p class="card-text">{% blocktrans %}
              Welcome back to The Gaming Verdict.
              Do you already have an account? Then please
              <a class="orange-link" href="{{ login_url }}">sign in</a>
              instead.
            {% endblocktrans %}</p>

            <form class="signup card-text" id="signup_form" method="post"
              action="{% url 'account_signup' %}">
              <fieldset>
                <legend class="visually-hidden">Create account information</legend>
                {% csrf_token %}
                
                {% if form.errors %}
                    <div class="alert alert-danger" role="alert" aria-live="polite" aria-atomic="true">
                        <strong>Error:</strong> Please correct the errors below.
                        <ul class="mb-0 mt-2">
                            {% for field, errors in form.errors.items %}
                                {% for error in errors %}
                                    <li>{% if field != '__all__' %}{{ field|title }}: {% endif %}{{ error }}</li>
                                {% endfor %}
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}
                
        {# Render all fields except password1 and password2 #}
        {% for field in form.visible_fields %}
          {% if field.name != 'password1' and field.name != 'password2' %}
            <div class="mb-3">
              {{ field.label_tag }}
              {{ field }}
              {% if field.help_text %}
                <small class="form-text text-muted">{{ field.help_text }}</small>
              {% endif %}
              {% for error in field.errors %}
                <div class="invalid-feedback d-block">{{ error }}</div>
              {% endfor %}
            </div>
          {% endif %}
        {% endfor %}

        {# Render password1 field manually #}
        <div class="mb-3">
          {{ form.password1.label_tag }}
          {{ form.password1 }}
          {% if form.password1.help_text %}
            <div id="id_password1_helptext" class="form-text text-white">{{ form.password1.help_text|safe }}</div>
          {% endif %}
          {# Removed inline password1 errors as requested #}
        </div>

        {# Render password2 field manually #}
        <div class="mb-3">
          {{ form.password2.label_tag }}
          {{ form.password2 }}
          {% if form.password2.help_text %}
            {{ form.password2.help_text|safe }}
          {% endif %}
          {% for error in form.password2.errors %}
            <div class="invalid-feedback d-block">{{ error }}</div>
          {% endfor %}
        </div>
                {% if redirect_field_value %}
                <input type="hidden" name="{{ redirect_field_name }}"
                  value="{{ redirect_field_value }}" />
                {% endif %}
              </fieldset>
              <button class="btn btn-outline-success right" type="submit">
                {% trans "Sign Up" %} &raquo;</button>
            </form>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>

{% endblock %}